name: Validate Commit Message

on: [push]

jobs:
  check-commit-message:
    runs-on: ubuntu-latest

    steps:
      - name: Validate latest commit message (title + body)
        run: |
          echo "Fetching full commit message from GitHub context..."
          echo "${{ github.event.head_commit.message }}" > commit_message.txt

          echo "Full commit message:"
          cat commit_message.txt

          # Allow merge commits
          if grep -qE "^Merge " commit_message.txt; then
            echo "ℹ️ Merge commit detected. Skipping issue number check."
            exit 0
          fi

          # Enforce issue number format like #123
          if ! grep -qE "#[0-9]+" commit_message.txt; then
            echo "❌ Commit message must include an issue number like #123"
            exit 1
          fi

          echo "✅ Commit message includes an issue number."
